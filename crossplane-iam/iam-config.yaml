#### iam-config file - IAM Policies, Roles, Groups and Users Configuration ###########

homeRegion: &HOME_REGION us-east-1

#####################################
# Identity Center Configuration
#####################################
identityCenter:
  name: AWSIdentityCenter
  delegatedAdminAccount: Audit

#####################################
# IAM Password Policy
#####################################
passwordPolicy:
  allowUsersToChangePassword: true
  hardExpiry: false
  requireLowercaseCharacters: true
  requireNumbers: true
  requireSymbols: true
  requireUppercaseCharacters: true
  maxPasswordAge: 90
  minimumPasswordLength: 14
  passwordReusePrevention: 24

#####################################
# IAM Access Analyzer
#####################################
accessAnalyzer:
  enable: true

#####################################
# IAM Policies
#####################################
policies:
  awsConfig:
    - policy: aws-config-policy
      deploymentTargets:
        accounts:
          - Management
          - Audit
  customerManaged:
    - name: AtosDefaultPolicy
      policy: iam-policies/atos-default-policy.json
      deploymentTargets:
        organizationalUnits:
          - Root
          - PCS
          - Infrastructure
    - name: AtosReadOnlyPolicy
      policy: iam-policies/atos-readonly-policy.json
      deploymentTargets:
        organizationalUnits:
          - PCS
          - Infrastructure
    - name: AtosSecurityAuditorPolicy
      policy: iam-policies/atos-security-auditor-policy.json
      deploymentTargets:
        accounts:
          - Audit
          - Management
    - name: AtosNetworkAdminPolicy
      policy: iam-policies/atos-network-admin-policy.json
      deploymentTargets:
        accounts:
          - Network

#####################################
# IAM Roles
#####################################
roleSets:
  - deploymentTargets:
      organizationalUnits:
        - PCS
        - Infrastructure
    roles:
      - name: AtosInstanceRole
        instanceProfile: true
        assumedBy:
          - type: service
            principal: ec2.amazonaws.com
        policies:
          awsManaged:
            - AmazonSSMManagedInstanceCore
            - CloudWatchAgentServerPolicy
          customerManaged:
            - AtosDefaultPolicy
        boundaryPolicy: AtosDefaultPolicy
      - name: AtosLambdaExecutionRole
        assumedBy:
          - type: service
            principal: lambda.amazonaws.com
        policies:
          awsManaged:
            - service-role/AWSLambdaBasicExecutionRole
          customerManaged:
            - AtosDefaultPolicy
        boundaryPolicy: AtosDefaultPolicy
      - name: AtosAdministratorRole
        assumedBy:
          - type: account
            principals:
              - Management
        policies:
          awsManaged:
            - AdministratorAccess
        externalId: atos-admin-external-id
        sessionDuration: 3600

  - deploymentTargets:
      accounts:
        - Audit
    roles:
      - name: AtosSecurityAuditorRole
        assumedBy:
          - type: account
            principals:
              - Management
        policies:
          awsManaged:
            - SecurityAudit
            - ReadOnlyAccess
          customerManaged:
            - AtosSecurityAuditorPolicy
        sessionDuration: 7200
      - name: AtosConfigRole
        assumedBy:
          - type: service
            principal: config.amazonaws.com
        policies:
          awsManaged:
            - service-role/ConfigRole
            - service-role/AWSConfigRoleForOrganizations

  - deploymentTargets:
      accounts:
        - Network
    roles:
      - name: AtosNetworkAdminRole
        assumedBy:
          - type: account
            principals:
              - Management
        policies:
          customerManaged:
            - AtosNetworkAdminPolicy
        sessionDuration: 3600

#####################################
# IAM Groups
#####################################
groupSets:
  - deploymentTargets:
      accounts:
        - Management
    groups:
      - name: AtosAdministrators
        policies:
          awsManaged:
            - AdministratorAccess
      - name: AtosReadOnlyUsers
        policies:
          customerManaged:
            - AtosReadOnlyPolicy
      - name: AtosDevelopers
        policies:
          awsManaged:
            - PowerUserAccess
          customerManaged:
            - AtosDefaultPolicy

#####################################
# IAM Users
#####################################
userSets:
  - deploymentTargets:
      accounts:
        - Management
    users:
      - username: atos-break-glass-admin
        group: AtosAdministrators
        boundaryPolicy: AtosDefaultPolicy
      - username: atos-readonly-user
        group: AtosReadOnlyUsers
        boundaryPolicy: AtosReadOnlyPolicy

#####################################
# Managed Active Directory
#####################################
managedActiveDirectories:
  - name: atos-managed-ad
    account: Management
    region: *HOME_REGION
    dnsName: atos.aws.local
    netBiosDomainName: ATOS
    description: "Atos Managed Active Directory"
    edition: Standard
    vpcSettings:
      vpcName: atos-pcsaws-dev-vpc03-us-east-1
      subnets:
        - subnet-private-a
        - subnet-private-b
    resolverRuleName: atos-ad-resolver-rule
    secretConfig:
      account: Management
      region: *HOME_REGION
      adminSecretName: atos-ad-admin-secret
    sharedOrganizationalUnits:
      - Infrastructure
      - PCS
    logs:
      groupName: /aws/directoryservice/atos-managed-ad
      retentionInDays: 30

#####################################
# SAML Providers
#####################################
samlProviders:
  - name: AtosAzureAD
    metadataDocument: saml-providers/atos-azure-ad-metadata.xml
    deploymentTargets:
      accounts:
        - Management
