#### organization-config file - AWS Organizations Configuration ###########

#####################################
# Organization Configuration
#####################################
organizationConfig:
  enable: true
  organizationAdminAccount: Management
  
#####################################
# Service Control Policies
#####################################
serviceControlPolicies:
  - name: AtosDenyHighRiskServices
    description: "Deny access to high-risk AWS services"
    policy: scp-policies/atos-deny-high-risk-services.json
    type: customerManaged
    deploymentTargets:
      organizationalUnits:
        - PCS
        - Infrastructure
        - Resources

  - name: AtosDenyRegionRestriction
    description: "Restrict operations to approved regions only"
    policy: scp-policies/atos-deny-region-restriction.json
    type: customerManaged
    deploymentTargets:
      organizationalUnits:
        - PCS
        - Infrastructure
        - Resources

  - name: AtosEnforceSecureTransport
    description: "Enforce HTTPS/TLS for all communications"
    policy: scp-policies/atos-enforce-secure-transport.json
    type: customerManaged
    deploymentTargets:
      organizationalUnits:
        - Root

  - name: AtosDenyRootActions
    description: "Deny root user actions except for emergency"
    policy: scp-policies/atos-deny-root-actions.json
    type: customerManaged
    deploymentTargets:
      organizationalUnits:
        - PCS
        - Infrastructure
        - Resources

  - name: AtosRequireMFAForSensitiveActions
    description: "Require MFA for sensitive operations"
    policy: scp-policies/atos-require-mfa-sensitive-actions.json
    type: customerManaged
    deploymentTargets:
      organizationalUnits:
        - PCS
        - Infrastructure

#####################################
# Backup Policies
#####################################
backupPolicies:
  - name: AtosDefaultBackupPolicy
    description: "Default backup policy for EC2 and RDS"
    policy: backup-policies/atos-default-backup-policy.json
    deploymentTargets:
      organizationalUnits:
        - PCS
        - Infrastructure
        - Resources

  - name: AtosCriticalBackupPolicy
    description: "Enhanced backup policy for critical resources"
    policy: backup-policies/atos-critical-backup-policy.json
    deploymentTargets:
      accounts:
        - Management
        - Audit
        - Network

#####################################
# Tag Policies
#####################################
tagPolicies:
  - name: AtosTaggingPolicy
    description: "Enforce Atos standard tagging across all resources"
    policy: tag-policies/atos-tagging-policy.json
    deploymentTargets:
      organizationalUnits:
        - Root

  - name: AtosCostCenterTagging
    description: "Require cost center and project tagging"
    policy: tag-policies/atos-cost-center-tagging.json
    deploymentTargets:
      organizationalUnits:
        - PCS
        - Infrastructure

#####################################
# AI Services Opt-out Policies
#####################################
aiServicesOptOutPolicies:
  - name: AtosAIServicesOptOut
    description: "Opt out of AI services data collection"
    policy: ai-policies/atos-ai-services-opt-out.json
    deploymentTargets:
      organizationalUnits:
        - Root

#####################################
# Quarantine SCP
#####################################
quarantineNewAccounts:
  enable: true
  scpPolicyName: AtosDenyAllExceptBreakGlass
  
#####################################
# Organizational Units
#####################################
organizationalUnits:
  - name: PCS
    parent: Root
    ignore: false
  - name: Infrastructure
    parent: Root
    ignore: false
  - name: Resources
    parent: Root
    ignore: false
  - name: Sandbox
    parent: Root
    ignore: false

#####################################
# Account Settings
#####################################
accountSettings:
  - name: default-ebs-encryption
    deploymentTargets:
      organizationalUnits:
        - Root
    ebsEncryptionByDefault: true
    ebsDefaultVolumeType: gp3

  - name: default-s3-public-block
    deploymentTargets:
      organizationalUnits:
        - Root
    s3PublicAccessBlock:
      enable: true
      excludeAccounts: []

  - name: default-ec2-imdsv2
    deploymentTargets:
      organizationalUnits:
        - Root
    ec2InstanceMetadataDefaults:
      httpEndpoint: enabled
      httpProtocolIpv6: disabled
      httpPutResponseHopLimit: 2
      httpTokens: required
      instanceMetadataTags: enabled

#####################################
# Central Logging
#####################################
centralLoggingBucket:
  lifecycleRules:
    - id: AtosLogLifecycle
      status: Enabled
      transitions:
        - days: 30
          storageClass: STANDARD_IA
        - days: 90
          storageClass: GLACIER
        - days: 365
          storageClass: DEEP_ARCHIVE
      abortIncompleteMultipartUpload: 7
      expiredObjectDeleteMarker: true
      noncurrentVersionTransitions:
        - noncurrentDays: 30
          storageClass: STANDARD_IA
        - noncurrentDays: 90
          storageClass: GLACIER
      noncurrentVersionExpiration: 2555 # 7 years

#####################################
# CloudTrail Configuration
#####################################
cloudTrail:
  enable: true
  organizationTrail: true
  organizationTrailSettings:
    multiRegionTrail: true
    globalServiceEvents: true
    managementEvents: true
    s3DataEvents: true
    lambdaDataEvents: true
    sendToCloudWatchLogs: true
    cloudWatchLogsRetentionInDays: 365
    apiErrorRateInsight: true
    apiCallRateInsight: false

#####################################
# Session Manager
#####################################
sessionManager:
  sendToCloudWatchLogs: true
  sendToS3: true
  excludeAccounts: []
  excludeRegions: []
  lifecycleRules:
    - id: AtosSessionManagerLogs
      status: Enabled
      transitions:
        - days: 90
          storageClass: GLACIER
      expiration: 2555 # 7 years
